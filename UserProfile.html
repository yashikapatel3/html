<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>User Profile</title>
    <link href="https://fonts.googleapis.com/css2?family=Cookie&family=Monoton&family=Poppins:wght@300;400;500;600;700;800&family=Roboto:wght@300;400;500;700&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        body {
            min-height: 100vh;
            background-image: url("/images/bb.jpg");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            font-family: 'Inter', 'Poppins', sans-serif;
            padding-top: 80px;
        }

        .profile-container {
            max-width: 900px;
            margin: 30px auto;
            padding: 0 15px;
        }

        .back-button {
            background: rgba(227, 3, 93, 0.723);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-bottom: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .back-button:hover {
            background: rgb(168, 9, 115);
            transform: translateX(-5px);
        }

        .profile-card {
            background: rgba(121, 121, 121, 0.4);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .profile-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .profile-image-container {
            width: 180px;
            height: 180px;
            margin: 0 auto 25px;
            position: relative;
        }

        .profile-image {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .profile-image:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 35px rgba(235, 45, 93, 0.5);
        }

        .profile-name {
            font-size: 2rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .profile-email {
            font-size: 1.1rem;
            color: rgb(248, 245, 245);
            margin-bottom: 15px;
        }

        .role-badge {
            display: inline-block;
            padding: 8px 24px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .role-admin {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
        }

        .role-user {
            background: linear-gradient(135deg, #c40354 0%, #eb732d 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(196, 3, 84, 0.4);
        }

        .profile-details {
            margin-top: 40px;
        }

        .detail-section {
            background: rgba(255, 255, 255, 0.285);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: #eb2d5d;
            font-size: 1.5rem;
        }

        .info-row {
            display: grid;
            grid-template-columns: 200px 1fr;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.95rem;
        }

        .info-value {
            color: #ffffff;
            font-weight: 500;
            font-size: 1rem;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-active {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
            border: 1px solid #28a745;
        }

        .status-inactive {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
            border: 1px solid #dc3545;
        }

        .action-buttons {
            margin-top: 30px;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-action {
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 0.95rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-make-admin {
            background: linear-gradient(135deg, #eb9f2d 0%, #f5576c 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(245, 87, 108, 0.3);
        }

        .btn-make-admin:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 87, 108, 0.5);
        }

        .btn-remove-admin {
            background: linear-gradient(135deg, #ea4b1f 0%, #fa709a 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(250, 112, 154, 0.3);
        }

        .btn-remove-admin:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(250, 112, 154, 0.5);
        }
         .btn-action {
            min-width: 140px;
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: 'Poppins', sans-serif;
            letter-spacing: 0.3px;
            white-space: nowrap;
        }

        .btn-block {
            background: linear-gradient(135deg, #ff5202 0%, #9d0119 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .btn-block:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.5);
        }

        .btn-unblock {
            background: linear-gradient(135deg, #05cc26 0%, #015811 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-unblock:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.5);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            opacity: 0.8;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .profile-card {
                padding: 25px;
            }

            .profile-image-container {
                width: 140px;
                height: 140px;
            }

            .profile-name {
                font-size: 1.5rem;
            }

            .info-row {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn-action {
                width: 100%;
                justify-content: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 576px) {
            body {
                padding-top: 60px;
            }

            .profile-container {
                margin: 15px auto;
            }

            .profile-card {
                padding: 20px;
            }

            .profile-name {
                font-size: 1.3rem;
            }

            .profile-email {
                font-size: 0.95rem;
            }

            .section-title {
                font-size: 1.1rem;
            }
        }
    </style>
</head>

<body>
<!-- NAVBAR -->
<div th:replace="~{fragments/navbar :: nav(activePage='dashboard')}"></div>

<div class="profile-container">
    <!-- Back Button -->
    <button class="back-button" onclick="history.back()">
        <i class="bi bi-arrow-left-circle"></i> Back to Users
    </button>

    <!-- Profile Card -->
    <div class="profile-card">
        <!-- Profile Header -->
        <div class="profile-header">
            <div class="profile-image-container">
                <img th:src="${photoBase64 != null} ? 'data:image/jpeg;base64,' + ${photoBase64} : @{/images/default.png}"
                     alt="Profile Picture"
                     class="profile-image" />
            </div>
            <h1 class="profile-name" th:text="${user.username}">User Name</h1>
            <p class="profile-email" th:text="${user.email}">user@example.com</p>
            <div>
                    <span class="role-badge role-admin" th:if="${user.role.name() == 'ADMIN'}">
                        <i class="bi bi-shield-fill-check"></i> Administrator
                    </span>
                <span class="role-badge role-user" th:if="${user.role.name() == 'USER'}">
                        <i class="bi bi-person-fill"></i> User
                    </span>
            </div>
        </div>

        <!-- Profile Details -->
        <div class="profile-details">
            <!-- Account Information -->
            <div class="detail-section">
                <h3 class="section-title">
                    <i class="bi bi-person-circle"></i>
                    Account Information
                </h3>
                <div class="info-row">
                    <span class="info-label">User ID</span>
                    <span class="info-value" th:text="${user.id}">#12345</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Username</span>
                    <span class="info-value" th:text="${user.username}">johndoe</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Email Address</span>
                    <span class="info-value" th:text="${user.email}">john@example.com</span>
                </div>
                <div class="info-row" th:if="${user.dob != null}">
                    <span class="info-label">Date of Birth</span>
                    <span class="info-value" th:text="${#temporals.format(user.dob, 'dd MMM yyyy')}">15 Jan 1990</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Account Status</span>
                    <span class="info-value">
                            <span class="status-badge status-active" th:if="${user.status == true}">
                                <i class="bi bi-check-circle-fill"></i> Active
                            </span>
                            <span class="status-badge status-inactive" th:if="${user.status == false}">
                                <i class="bi bi-x-circle-fill"></i> Inactive
                            </span>
                        </span>
                </div>
                <div class="info-row" th:if="${user.createdDate != null}">
                    <span class="info-label">Member Since</span>
                    <span class="info-value" th:text="${#temporals.format(user.createdDate, 'dd MMM yyyy')}">15 Jan 2024</span>
                </div>
                <div class="info-row" th:if="${user.reviews != null}">
                    <span class="info-label">Total Reviews</span>
                    <span class="info-value" th:text="${#lists.size(user.reviews)}">0</span>
                </div>
            </div>

            <!-- Statistics -->
            <div class="detail-section" th:if="${user.reviews != null && #lists.size(user.reviews) > 0}">
                <h3 class="section-title">
                    <i class="bi bi-bar-chart-fill"></i>
                    Activity Statistics
                </h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">‚≠ê</div>
                        <div class="stat-value" th:text="${#lists.size(user.reviews)}">0</div>
                        <div class="stat-label">Reviews Written</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìÖ</div>
                        <div class="stat-value" th:text="${user.createdDate != null ? #temporals.format(user.createdDate, 'yyyy') : 'N/A'}">2024</div>
                        <div class="stat-label">Member Since</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="bi bi-shield-check" th:if="${user.role.name() == 'ADMIN'}" style="font-size: 2.5rem; color: #28a745;"></i>
                            <i class="bi bi-person" th:if="${user.role.name() == 'USER'}" style="font-size: 2.5rem; color: #c40354;"></i>
                        </div>
                        <div class="stat-value" th:text="${user.role.name()}">USER</div>
                        <div class="stat-label">Role</div>
                    </div>
                </div>
            </div>

            <!-- Admin Actions -->
            <div class="action-buttons" th:if="${isAdmin}">
                <!-- Make/Remove Admin -->
                <form th:if="${user.role.name() == 'USER'}"
                      th:action="@{/make-admin/{id}(id=${user.id})}"
                      method="post"
                      onsubmit="return confirmMakeAdmin(this)"
                      style="margin: 0;">
                    <button type="submit" class="btn-action btn-make-admin" th:data-username="${user.username}">
                        <i class="bi bi-shield-fill-check"></i> Make Admin
                    </button>
                </form>

                <form th:if="${user.role.name() == 'ADMIN'}"
                      th:action="@{/remove-admin/{id}(id=${user.id})}"
                      method="post"
                      onsubmit="return confirmRemoveAdmin(this)"
                      style="margin: 0;">
                    <button type="submit" class="btn-action btn-remove-admin" th:data-username="${user.username}">
                        <i class="bi bi-person-x-fill"></i> Remove Admin
                    </button>
                </form>
                 <!-- Block Button -->
                <form th:if="${user.status}"
                      th:action="@{/block-user/{id}(id=${user.id})}" 
                      method="post"
                      onsubmit="return confirmBlock(this)">
                    <button type="submit" class="btn-action btn-block" 
                            th:data-username="${user.username}"
                            th:data-email="${user.email}">
                        <i class="bi bi-lock-fill"></i> Block User
                    </button>
                </form>
                 <!-- Unblock Button -->
                <form th:if="${!user.status}"
                      th:action="@{/unblock-user/{id}(id=${user.id})}" 
                      method="post"
                      onsubmit="return confirmUnblock(this)">
                    <button type="submit" class="btn-action btn-unblock" 
                            th:data-username="${user.username}"
                            th:data-email="${user.email}">
                        <i class="bi bi-unlock-fill"></i> Unblock User
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Confirmation for Make Admin
    function confirmMakeAdmin(form) {
        event.preventDefault();
        const username = form.querySelector('button').getAttribute('data-username');

        Swal.fire({
            title: 'Make Admin?',
            html: `Are you sure you want to make <strong>${username}</strong> an Admin?`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#f5576c',
            cancelButtonColor: '#6c757d',
            confirmButtonText: '<i class="bi bi-shield-check"></i> Yes, Make Admin!',
            cancelButtonText: 'Cancel',
            background: 'rgba(30, 30, 35, 0.95)',
            color: '#ffffff',
        }).then((result) => {
            if (result.isConfirmed) {
                form.submit();
            }
        });
        return false;
    }

    // Confirmation for Remove Admin
    function confirmRemoveAdmin(form) {
        event.preventDefault();
        const username = form.querySelector('button').getAttribute('data-username');

        Swal.fire({
            title: 'Remove Admin Role?',
            html: `Are you sure you want to remove Admin role from <strong>${username}</strong>?`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#fa709a',
            cancelButtonColor: '#6c757d',
            confirmButtonText: '<i class="bi bi-person-x"></i> Yes, Remove!',
            cancelButtonText: 'Cancel',
            background: 'rgba(30, 30, 35, 0.95)',
            color: '#ffffff',
        }).then((result) => {
            if (result.isConfirmed) {
                form.submit();
            }
        });
        return false;
    }
    // Confirmation for Block User with Sweet Alert
        function confirmBlock(form) {
            event.preventDefault();
            const username = form.querySelector('button').getAttribute('data-username');
            const email = form.querySelector('button').getAttribute('data-email');

            Swal.fire({
                title: 'Block User?',
                html: `Are you sure you want to block <strong>${username}</strong>?<br><br>Email: ${email}<br><br>They will not be able to access their account and will receive a notification email.`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#dc3545',
                cancelButtonColor: '#6c757d',
                confirmButtonText: '<i class="bi bi-lock-fill"></i> Yes, Block User!',
                cancelButtonText: '<i class="bi bi-x-circle"></i> Cancel',
                background: 'rgba(30, 30, 35, 0.95)',
                color: '#ffffff',
                backdrop: 'rgba(0, 0, 0, 0.7)',
                customClass: {
                    popup: 'swal-custom-popup',
                    title: 'swal-custom-title',
                    confirmButton: 'swal-custom-confirm',
                    cancelButton: 'swal-custom-cancel'
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    form.submit();
                }
            });

            return false;
        }

        // Confirmation for Unblock User with Sweet Alert
        function confirmUnblock(form) {
            event.preventDefault();
            const username = form.querySelector('button').getAttribute('data-username');
            const email = form.querySelector('button').getAttribute('data-email');

            Swal.fire({
                title: 'Unblock User?',
                html: `Are you sure you want to unblock <strong>${username}</strong>?<br><br>Email: ${email}<br><br>They will regain access to their account and will receive a notification email.`,
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#28a745',
                cancelButtonColor: '#6c757d',
                confirmButtonText: '<i class="bi bi-unlock-fill"></i> Yes, Unblock User!',
                cancelButtonText: '<i class="bi bi-x-circle"></i> Cancel',
                background: 'rgba(30, 30, 35, 0.95)',
                color: '#ffffff',
                backdrop: 'rgba(0, 0, 0, 0.7)',
                customClass: {
                    popup: 'swal-custom-popup',
                    title: 'swal-custom-title',
                    confirmButton: 'swal-custom-confirm',
                    cancelButton: 'swal-custom-cancel'
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    form.submit();
                }
            });

            return false;
        }

        // Filter Users by Search
        function filterUsers() {
            let searchInput = document.getElementById("userSearch").value.toLowerCase().trim();
            let cards = document.querySelectorAll(".user-card");

            cards.forEach(card => {
                let email = card.getAttribute("data-email") ? card.getAttribute("data-email").toLowerCase() : '';
                let name = card.getAttribute("data-name") ? card.getAttribute("data-name").toLowerCase() : '';
                let status = card.getAttribute("data-status") ? card.getAttribute("data-status").toLowerCase() : '';

                // Check search match
                let searchMatch = searchInput === '' ||
                    email.includes(searchInput) ||
                    name.includes(searchInput);

                // Check status filter match
                let statusMatch = currentStatusFilter === 'all' || status === currentStatusFilter;

                // Show card only if both conditions are met
                if (searchMatch && statusMatch) {
                    card.style.display = "";
                } else {
                    card.style.display = "none";
                }
            });
        }
</script>
</body>
</html>